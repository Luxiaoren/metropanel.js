var Tile=function(){function n(n,t,i,r,u,f){this.left=n,this.top=t,this.content=i,this.index=r,this.width=u,this.panelId=f,this.id=f.substr(1)+"_tile"+r}return n.prototype.getHtml=function(){var n="<div id='{3}' class='tile' style='position: absolute; left: {0}px; top: {1}px; width: {4}px; -moz-user-select: none; -khtml-user-select: none;  -webkit-user-select: none; user-select: none;'>{2}</div>";return n.replace("{0}",this.left.toString()).replace("{1}",this.top.toString()).replace("{2}",this.content).replace("{3}",this.id).replace("{4}",this.width.toString())},n.prototype.beginDrag=function(){this.isBeingDragged=!0,this.supposedX=this.left,this.supposedY=this.top,$("#"+this.id).css("z-index","999999999999")},n.prototype.moveBy=function(n,t){if(this.isBeingDragged){var i=$("#"+this.id);i.animate({left:"+="+n,top:"+="+t},0),this.left+=n,this.top+=t}},n.prototype.moveTo=function(n,t){var i=$("#"+this.id);i.animate({left:n,top:t},"fast","linear"),this.left=n,this.top=t},n.prototype.supposePosition=function(n,t){this.isBeingDragged&&(this.supposedX=n,this.supposedY=t)},n.prototype.endDrag=function(){this.moveTo(this.supposedX,this.supposedY),$("#"+this.id).css("z-index",""),this.isBeingDragged=!1},n.prototype.compare=function(n){var t=this.isBeingDragged?this.supposedY:this.top,i=this.isBeingDragged?this.supposedX:this.left,r=n.isBeingDragged?n.supposedY:n.top,u=n.isBeingDragged?n.supposedX:n.left;return t<r?-1:t>r?1:i<u?-1:i>u?1:0},n.prototype.isOver=function(n){var t=Math.abs(n.top-this.top),i=Math.abs(n.left-this.left);return t<=40&&i<=80},n}(),MetroPanel=function(){function n(n,t,i){this.maxWidth=n,this.panelId=t,this.maxHeight=i,this.count=0,this.newTileX=10,this.newTileY=60,this.tiles=[]}return n.prototype.addTile=function(n,t,i){var u=this,r,f;this.newTileX+t>this.maxWidth&&(this.newTileX=10,this.newTileY+=160),r=new Tile(this.newTileX,this.newTileY,n,this.count++,t,this.panelId),f=r.getHtml(),$(this.panelId).append(f),$("#"+r.id).mousedown(function(n){u.handleTileMouseDown(r,n)}),$("#"+r.id).mouseup(function(n){u.handleTileMouseUp(r,n)}),$("#"+r.id).mousemove(function(n){u.handleTileMouseMove(r,n)}),this.tiles.push(r),this.newTileX+=t+i},n.prototype.handleTileMouseDown=function(n,t){t.preventDefault(),n.beginDrag(),this.lastMouseX=t.pageX,this.lastMouseY=t.pageY},n.prototype.handleTileMouseMove=function(t,i){var r=this,u,f;i.preventDefault(),t.isBeingDragged&&(u=i.pageX-this.lastMouseX,f=i.pageY-this.lastMouseY,t.moveBy(u,f),this.lastMouseX=i.pageX,this.lastMouseY=i.pageY,this.destroyTimeOut(),this.timeout=setTimeout(function(){n.findOversAndSuppose(t,r),r.destroyTimeOut()},50))},n.findOversAndSuppose=function(n,t){var r=t.tiles.filter(function(t){return n!=t&&t.isOver(n)}).sort(function(t){return Math.abs(t.left-n.left)}),i=r[0];i&&(n.supposePosition(n.left,i.top),t.orderPanel())},n.prototype.otherGroupIntersection=function(n){var u=this,t=$("#"+n.id),f=t.offset().left,e=panels.filter(function(n){return n!=u&&Math.abs($(n.panelId).offset().left-f)<=20}),i=e[0],r;return i?(r=this.tiles.indexOf(n),r!=-1&&this.tiles.splice(r,1),t.off("mousedown"),t.off("mouseup"),t.off("mousemove"),i.tiles.push(n),t.mousedown(function(t){i.handleTileMouseDown(n,t)}),t.mouseup(function(t){i.handleTileMouseUp(n,t)}),t.mousemove(function(t){i.handleTileMouseMove(n,t)}),!0):!1},n.prototype.orderPanel=function(){for(var u=this.tiles.sort(function(n,t){return n.compare(t)}),n=10,r=60,t,i=0;i<this.tiles.length;i++)t=u[i],n+t.width>this.maxWidth&&(n=10,r+=160),t.isBeingDragged?t.supposePosition(n,r):t.moveTo(n,r),n+=t.width+10;this.newTileX=n},n.prototype.destroyTimeOut=function(){clearTimeout(this.timeout)},n.prototype.handleTileMouseUp=function(n,t){t.preventDefault(),this.destroyTimeOut(),n.isBeingDragged&&n.endDrag()},n}()