var Rect=function(){function n(n,t,i,r){this.x=n,this.y=t,this.width=i,this.height=r}return n.min=function(n,t){return n<t?n:t},n.max=function(n,t){return n>t?n:t},n.XDistance=function(n,t){return Math.abs(n.x-t.x)},n.YDistance=function(n,t){return Math.abs(n.y-t.y)},n}(),Tile=function(){function n(n,t,i,r){this.left=n,this.top=t,this.content=i,this.index=r,this.id="tile"+r}return n.prototype.getHtml=function(){var n="<div id='{3}' class='tile' style='position: absolute; left: {0}px; top: {1}px;'>{2}</div>";return n.replace("{0}",this.left.toString()).replace("{1}",this.top.toString()).replace("{2}",this.content).replace("{3}",this.id)},n.prototype.getRect=function(){return new Rect(this.left,this.top,150,150)},n.prototype.beginDrag=function(){this.isBeingDragged=!0,this.supposedX=this.left,this.supposedY=this.top,$("#"+this.id).css("z-index","999999999999")},n.prototype.moveBy=function(n,t){if(this.isBeingDragged){var i=$("#"+this.id);i.animate({left:"+="+n,top:"+="+t},0),this.left+=n,this.top+=t,$("#info").html("Left: "+this.left+"\nTop : "+this.top)}},n.prototype.moveTo=function(n,t){var i=$("#"+this.id);i.animate({left:n,top:t},"fast","swing"),this.left=n,this.top=t},n.prototype.supposePosition=function(n,t){this.isBeingDragged&&(this.supposedX=n,this.supposedY=t)},n.prototype.endDrag=function(){this.moveTo(this.supposedX,this.supposedY),$("#"+this.id).css("z-index",""),this.isBeingDragged=!1},n}(),MetroPanel=function(){function n(n,t){this.maxWidth=n,this.panelId=t,this.count=0,this.lastTileLeft=-150,this.lastTileTop=60,this.tiles=[]}return n.prototype.addTile=function(n){var u=this,r,f;this.lastTileLeft+160<this.maxWidth?this.lastTileLeft+=160:(this.lastTileLeft=10,this.lastTileTop+=160),r=new Tile(this.lastTileLeft,this.lastTileTop,n,this.count++),f=r.getHtml(),$(this.panelId).after(f),$("#"+r.id).mousedown(function(n){u.handleTileMouseDown(r,n)}),$("#"+r.id).mouseup(function(n){u.handleTileMouseUp(r,n)}),$("#"+r.id).mousemove(function(n){u.handleTileMouseMove(r,n)}),this.tiles.push(r)},n.prototype.handleTileMouseDown=function(n,t){n.beginDrag(),console.log(n.getRect()),this.lastMouseX=t.pageX,this.lastMouseY=t.pageY},n.prototype.handleTileMouseMove=function(n,t){var r,u;if(n.isBeingDragged){r=t.pageX-this.lastMouseX,u=t.pageY-this.lastMouseY,n.moveBy(r,u),this.lastMouseX=t.pageX,this.lastMouseY=t.pageY;var h=n.getRect(),f=this.tiles.filter(function(t){return t!==n&&Rect.XDistance(t.getRect(),n.getRect())<=50&&t.top==n.supposedY}),e=this.tiles.filter(function(t){return t!==n&&Rect.YDistance(t.getRect(),n.getRect())<=50&&t.left==n.supposedX});if(f.length==1){var i=f[0],o=n.supposedX,s=n.supposedY;n.supposePosition(i.left,i.top),i.moveTo(o,s)}if(e.length==1){var i=e[0],o=n.supposedX,s=n.supposedY;n.supposePosition(i.left,i.top),i.moveTo(o,s)}}},n.prototype.handleTileMouseUp=function(n){n.isBeingDragged&&n.endDrag()},n}()